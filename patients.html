<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Prince Alex Hospital - Patients</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Poppins', sans-serif; }
    body {
      display: flex;
      min-height: 100vh;
      background: #f4f7fa;
    }
    /* Sidebar */
    .sidebar {
      width: 220px;
      background: #004085;
      color: white;
      display: flex;
      flex-direction: column;
      padding: 20px;
    }
    .sidebar h2 {
      margin-bottom: 30px;
      font-size: 22px;
      text-align: center;
    }
    .sidebar a {
      color: white;
      text-decoration: none;
      padding: 12px;
      margin: 6px 0;
      border-radius: 8px;
      display: block;
      transition: background 0.2s;
    }
    .sidebar a:hover {
      background: #0062cc;
    }

    /* Main */
    .main {
      flex: 1;
      padding: 20px;
    }
    .topbar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: white;
      padding: 12px 20px;
      border-radius: 10px;
      margin-bottom: 20px;
      box-shadow: 0 3px 8px rgba(0,0,0,0.1);
    }
    .topbar input {
      padding: 8px 12px;
      border: 1px solid #ccc;
      border-radius: 8px;
      width: 200px;
    }
    h1 {
      font-size: 20px;
      color: #004085;
    }

    /* Table */
    table {
      width: 100%;
      border-collapse: separate;
      border-spacing: 0 10px;
    }
    th, td {
      padding: 12px;
      text-align: left;
      background: white;
    }
    th {
      background: #004085;
      color: white;
    }
    tr {
      border-radius: 8px;
      transition: 0.2s;
    }
    tr:hover { background: #f1f8ff; }

    .actions button {
      margin-right: 5px;
      border: none;
      padding: 6px 10px;
      border-radius: 6px;
      cursor: pointer;
      color: white;
    }
    .edit-btn { background: #17a2b8; }
    .delete-btn { background: #dc3545; }

    /* Floating Add Button */
    .fab {
      position: fixed;
      bottom: 25px;
      right: 25px;
      background: #28a745;
      color: white;
      font-size: 22px;
      padding: 18px;
      border-radius: 50%;
      box-shadow: 0 6px 16px rgba(0,0,0,0.3);
      cursor: pointer;
      transition: transform 0.2s;
    }
    .fab:hover { transform: scale(1.1) rotate(90deg); }

    /* Modal */
    .modal {
      display: none;
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0,0,0,0.6);
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .modal-content {
      background: white;
      padding: 25px;
      border-radius: 12px;
      width: 400px;
      max-width: 95%;
    }
    .modal-content h2 {
      margin-bottom: 15px;
      color: #004085;
      text-align: center;
    }
    label { font-weight: 600; display: block; margin-top: 10px; }
    input, textarea {
      width: 100%;
      padding: 10px;
      border-radius: 8px;
      border: 1px solid #ccc;
      margin-top: 5px;
    }
    .modal-content button {
      margin-top: 15px;
      padding: 10px;
      width: 100%;
      border: none;
      border-radius: 8px;
      cursor: pointer;
    }
    .save-btn { background: #004085; color: white; }
    .cancel-btn { background: #6c757d; color: white; }

    /* Toast */
    .toast {
      position: fixed;
      top: 20px;
      right: 20px;
      background: #28a745;
      color: white;
      padding: 12px 20px;
      border-radius: 8px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.2);
      display: none;
      z-index: 1000;
    }
    .toast.error { background: #dc3545; }

    /* Responsive */
    @media(max-width: 768px) {
      body { flex-direction: column; }
      .sidebar { flex-direction: row; width: 100%; }
      .sidebar a { flex: 1; text-align: center; }
    }
  </style>
</head>
<body>
  <!-- Sidebar -->
  <div class="sidebar">
    <h2>Prince Alex</h2>
    <a href="#">üè† Dashboard</a>
    <a href="#">üë®‚Äç‚öïÔ∏è Doctors</a>
    <a href="#">üßë‚Äçü§ù Patients</a>
    <a href="#">üß™ Lab</a>
    <a href="#">üíä Pharmacy</a>
    <a href="#">üíµ Billing</a>
    <a href="#" onclick="logout()">üö™ Logout</a>
  </div>

  <!-- Main Content -->
  <div class="main">
    <div class="topbar">
      <h1>Patients Management</h1>
      <input type="text" id="search" placeholder="Search by name...">
    </div>

    <table id="patientsTable">
      <thead>
        <tr>
          <th>Name</th><th>Age</th><th>Gender</th><th>Contact</th>
          <th>Address</th><th>History</th><th>Actions</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <!-- Floating Add Button -->
  <div class="fab" onclick="openModal()">‚ûï</div>

  <!-- Modal Form -->
  <div class="modal" id="patientModal">
    <div class="modal-content">
      <h2 id="modalTitle">Add New Patient</h2>
      <form id="patientForm">
        <label>Name:</label>
        <input type="text" id="name" required>
        <label>Age:</label>
        <input type="number" id="age" required>
        <label>Gender:</label>
        <input type="text" id="gender" required>
        <label>Contact:</label>
        <input type="text" id="contact" required>
        <label>Address:</label>
        <input type="text" id="address" required>
        <label>History:</label>
        <textarea id="history" rows="3"></textarea>

        <button type="submit" class="save-btn">Save Patient</button>
        <button type="button" id="cancelBtn" class="cancel-btn">Cancel</button>
      </form>
    </div>
  </div>

  <!-- Toast Notification -->
  <div class="toast" id="toast"></div>

  <script>
    const modal = document.getElementById("patientModal");
    const form = document.getElementById("patientForm");
    const toast = document.getElementById("toast");
    const tableBody = document.querySelector("#patientsTable tbody");
    const searchBox = document.getElementById("search");
    const modalTitle = document.getElementById("modalTitle");
    const cancelBtn = document.getElementById("cancelBtn");

    let patients = JSON.parse(localStorage.getItem("patients")) || [];
    let editIndex = -1; // track editing

    function openModal(isEdit = false) {
      modal.style.display = "flex";
      modalTitle.textContent = isEdit ? "Edit Patient" : "Add New Patient";
    }
    window.onclick = function(e) { if (e.target == modal) closeModal(); }

    function closeModal() {
      modal.style.display = "none";
      form.reset();
      editIndex = -1;
    }

    cancelBtn.addEventListener("click", closeModal);

    function showToast(msg, type="success") {
      toast.textContent = msg;
      toast.className = "toast " + (type === "error" ? "error" : "");
      toast.style.display = "block";
      setTimeout(() => toast.style.display = "none", 2500);
    }

    function renderPatients(filter="") {
      tableBody.innerHTML = "";
      patients
        .filter(p => p.name.toLowerCase().includes(filter.toLowerCase()))
        .forEach((p, i) => {
          const row = document.createElement("tr");
          row.innerHTML = `
            <td>${p.name}</td><td>${p.age}</td><td>${p.gender}</td>
            <td>${p.contact}</td><td>${p.address}</td><td>${p.history}</td>
            <td class="actions">
              <button class="edit-btn" onclick="editPatient(${i})">‚úèÔ∏è</button>
              <button class="delete-btn" onclick="deletePatient(${i})">üóëÔ∏è</button>
            </td>`;
          tableBody.appendChild(row);
        });
    }

    form.addEventListener("submit", function(e){
      e.preventDefault();

      const newPatient = {
        name: document.getElementById("name").value.trim(),
        age: document.getElementById("age").value,
        gender: document.getElementById("gender").value.trim(),
        contact: document.getElementById("contact").value.trim(),
        address: document.getElementById("address").value.trim(),
        history: document.getElementById("history").value.trim()
      };

      if (!newPatient.name || !newPatient.age || !newPatient.gender || !newPatient.contact || !newPatient.address) {
        showToast("Please fill all required fields.", "error");
        return;
      }

      if (editIndex === -1) {
        patients.push(newPatient);
        showToast("Patient added successfully!");
      } else {
        patients[editIndex] = newPatient;
        showToast("Patient updated successfully!");
        editIndex = -1;
      }

      localStorage.setItem("patients", JSON.stringify(patients));

      closeModal();
      renderPatients();
    });

    function editPatient(i) {
      const p = patients[i];
      document.getElementById("name").value = p.name;
      document.getElementById("age").value = p.age;
      document.getElementById("gender").value = p.gender;
      document.getElementById("contact").value = p.contact;
      document.getElementById("address").value = p.address;
      document.getElementById("history").value = p.history;

      editIndex = i;
      openModal(true);
    }

    function deletePatient(i) {
      if (confirm("Delete this patient?")) {
        patients.splice(i,1);
        localStorage.setItem("patients", JSON.stringify(patients));
        renderPatients();
        showToast("Patient deleted.");
      }
    }

    searchBox.addEventListener("input", function(){ renderPatients(this.value); });
    function logout(){ localStorage.removeItem("loggedInUser"); window.location.href="index.html"; }

    renderPatients();
  </script>
</body>
</html>
