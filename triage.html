<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Prince Alex Hospital - Triage</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
  <style>
    * { margin:0; padding:0; box-sizing:border-box; font-family:'Poppins',sans-serif; }
    body { display:flex; min-height:100vh; background:#f4f7fa; }
    /* Sidebar */
    .sidebar { width:220px; background:#004085; color:white; display:flex; flex-direction:column; padding:20px; }
    .sidebar h2 { margin-bottom:30px; font-size:22px; text-align:center; }
    .sidebar a { color:white; text-decoration:none; padding:12px; margin:6px 0; border-radius:8px; display:block; transition:background 0.2s; }
    .sidebar a:hover { background:#0062cc; }
    /* Main */
    .main { flex:1; padding:20px; }
    .topbar { display:flex; justify-content:space-between; align-items:center; background:white; padding:12px 20px; border-radius:10px; margin-bottom:20px; box-shadow:0 3px 8px rgba(0,0,0,0.1); }
    h1 { font-size:20px; color:#004085; }
    /* Table */
    table { width:100%; border-collapse:separate; border-spacing:0 10px; }
    th, td { padding:12px; text-align:left; background:white; }
    th { background:#004085; color:white; }
    tr { border-radius:8px; transition:0.2s; }
    tr:hover { background:#f1f8ff; }
    .actions button { margin-right:5px; border:none; padding:6px 10px; border-radius:6px; cursor:pointer; color:white; }
    .edit-btn { background:#17a2b8; }
    /* Modal */
    .modal { display:none; position:fixed; top:0; left:0; right:0; bottom:0; background:rgba(0,0,0,0.6); display:flex; align-items:center; justify-content:center; }
    .modal-content { background:white; padding:25px; border-radius:12px; width:420px; max-width:95%; max-height:80vh; overflow-y:auto; }
    .modal-content h2 { margin-bottom:15px; color:#004085; text-align:center; }
    label { font-weight:600; display:block; margin-top:10px; }
    input, textarea { width:100%; padding:10px; border-radius:8px; border:1px solid #ccc; margin-top:5px; }
    .modal-content button { margin-top:15px; padding:10px; width:100%; border:none; border-radius:8px; cursor:pointer; }
    .save-btn { background:#004085; color:white; }
    .cancel-btn { background:#6c757d; color:white; }
    /* Toast */
    .toast { position:fixed; top:20px; right:20px; background:#28a745; color:white; padding:12px 20px; border-radius:8px; box-shadow:0 4px 10px rgba(0,0,0,0.2); display:none; z-index:1000; }
    .toast.error { background:#dc3545; }
    /* Responsive */
    @media(max-width:768px){ body{flex-direction:column;} .sidebar{flex-direction:row;width:100%;} .sidebar a{flex:1;text-align:center;} }
  </style>
</head>
<body>
  <!-- Sidebar -->
  <div class="sidebar">
    <h2>Prince Alex</h2>
    <a href="patients.html">üßë‚Äçü§ù Patients</a>
    <a href="triage.html">ü©∫ Triage</a>
    <a href="#">üë®‚Äç‚öïÔ∏è Doctors</a>
    <a href="#">üß™ Lab</a>
    <a href="#">üíä Pharmacy</a>
    <a href="#">üíµ Billing</a>
    <a href="#" onclick="logout()">üö™ Logout</a>
  </div>

  <!-- Main Content -->
  <div class="main">
    <div class="topbar">
      <h1>Triage Management</h1>
    </div>

    <table id="triageTable">
      <thead>
        <tr>
          <th>Name</th><th>Age</th><th>Gender</th>
          <th>Complaint</th><th>Vitals</th><th>Actions</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <!-- Modal Form -->
  <div class="modal" id="triageModal">
    <div class="modal-content">
      <h2 id="modalTitle">Record Triage</h2>
      <form id="triageForm">
        <label>Temperature (¬∞C):</label>
        <input type="number" id="temperature" step="0.1" required>
        <label>Blood Pressure:</label>
        <input type="text" id="bloodPressure" placeholder="120/80" required>
        <label>Pulse (bpm):</label>
        <input type="number" id="pulse" required>
        <label>Respiration (breaths/min):</label>
        <input type="number" id="respiration" required>
        <label>Weight (kg):</label>
        <input type="number" id="weight" step="0.1" required>
        <label>Height (cm):</label>
        <input type="number" id="height" required>
        <label>Complaint:</label>
        <textarea id="complaint" rows="3" required></textarea>

        <button type="submit" class="save-btn">Save Triage</button>
        <button type="button" id="cancelBtn" class="cancel-btn">Cancel</button>
      </form>
    </div>
  </div>

  <!-- Toast -->
  <div class="toast" id="toast"></div>

  <script>
    const modal = document.getElementById("triageModal");
    const form = document.getElementById("triageForm");
    const toast = document.getElementById("toast");
    const tableBody = document.querySelector("#triageTable tbody");
    const modalTitle = document.getElementById("modalTitle");
    const cancelBtn = document.getElementById("cancelBtn");

    let patients = JSON.parse(localStorage.getItem("patients")) || [];
    let editIndex = -1;

    function openModal(i) {
      editIndex = i;
      const patient = patients[i];
      modalTitle.textContent = `Record Triage - ${patient.name}`;
      
      // Pre-fill if triage exists
      if (patient.triage) {
        document.getElementById("temperature").value = patient.triage.temperature;
        document.getElementById("bloodPressure").value = patient.triage.bloodPressure;
        document.getElementById("pulse").value = patient.triage.pulse;
        document.getElementById("respiration").value = patient.triage.respiration;
        document.getElementById("weight").value = patient.triage.weight;
        document.getElementById("height").value = patient.triage.height;
        document.getElementById("complaint").value = patient.triage.complaint;
      } else {
        form.reset();
      }

      modal.style.display = "flex";
    }

    function closeModal() {
      modal.style.display = "none";
      form.reset();
      editIndex = -1;
    }
    cancelBtn.addEventListener("click", closeModal);
    window.onclick = function(e){ if(e.target == modal) closeModal(); }

    function showToast(msg, type="success") {
      toast.textContent = msg;
      toast.className = "toast " + (type==="error"?"error":"");
      toast.style.display = "block";
      setTimeout(()=> toast.style.display="none",2500);
    }

    form.addEventListener("submit", function(e){
      e.preventDefault();
      if(editIndex === -1) {
        showToast("No patient selected", "error");
        return;
      }

      const triageData = {
        temperature: document.getElementById("temperature").value,
        bloodPressure: document.getElementById("bloodPressure").value,
        pulse: document.getElementById("pulse").value,
        respiration: document.getElementById("respiration").value,
        weight: document.getElementById("weight").value,
        height: document.getElementById("height").value,
        complaint: document.getElementById("complaint").value.trim()
      };

      patients[editIndex].triage = triageData;
      localStorage.setItem("patients", JSON.stringify(patients));
      console.log("Saved triage:", triageData); // Debug log

      showToast("Triage saved successfully!");
      closeModal();
      renderPatients();
    });

    function renderPatients() {
      tableBody.innerHTML = "";
      if(patients.length === 0) {
        tableBody.innerHTML = "<tr><td colspan='6' style='text-align:center;color:red'>No patients found. Please add patients first.</td></tr>";
        return;
      }
      patients.forEach((p, i) => {
        const triage = p.triage 
          ? `${p.triage.temperature}¬∞C, BP:${p.triage.bloodPressure}, Pulse:${p.triage.pulse}, Resp:${p.triage.respiration}, W:${p.triage.weight}kg, H:${p.triage.height}cm`
          : "Not Recorded";
        const complaint = p.triage ? p.triage.complaint : "Not Recorded";

        const row = document.createElement("tr");
        row.innerHTML = `
          <td>${p.name}</td>
          <td>${p.age}</td>
          <td>${p.gender || "-"}</td>
          <td>${complaint}</td>
          <td>${triage}</td>
          <td class="actions">
            <button class="edit-btn" onclick="openModal(${i})">‚úèÔ∏è Record</button>
          </td>
        `;
        tableBody.appendChild(row);
      });
    }

    function logout(){
      localStorage.removeItem("loggedInUser");
      window.location.href="index.html";
    }

    renderPatients();
  </script>
</body>
</html>
